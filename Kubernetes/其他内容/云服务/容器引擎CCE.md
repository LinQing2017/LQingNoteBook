# 容器引擎CCE

## 1. 差异对比

| 对比项   | 容器引擎CCE                                                  | SDP                                  | Message                     |
| -------- | ------------------------------------------------------------ | ------------------------------------ | --------------------------- |
| 软件版本 | K8S：v1.13.10/**v1.16.8**/v1.18.9（百度定制版本）<br />Docker：docker://18.9.2<br /> | K8S：**v1.16.13**                    | K8S API完全兼容，不需要修改 |
| 部署方式 | 云平台脚本部署<br />ETCD、API Server等管理服务通过bin文件的方式部署 | kubeadm 部署<br />管理服务容器化部署 | **CCE 可以一键扩容**        |
| 认证方式 | x509                                                         | x509                                 |                             |
| 日志采集 | 可以配置将日志直接写到ES                                     | 通过Filebeat采集到Kafka              |                             |

## 2. 额外功能

容器引擎CCE提供以下功能，SDP没有的：

- 工作节点弹性伸缩
- 集群审计：提供所有针对K8S的更新操作记录
- LoadBalancer Service ：提供基于4层TCP/UDP 容器代理（SDP只能提供7层的代理）
- 挂载块设备到容器

# 容器镜像服务CCR

## 1. 差异对比

| 对比项   | 容器引擎CCE     | SDP           | Message       |
| -------- | --------------- | ------------- | ------------- |
| 软件版本 | 容器镜像服务CCR | Harbor v2.0.2 | API完全不兼容 |

由于SDP主镜像仓库部署在长乐，采用是Harbor v2.0.2，用自定义镜像先推送到长乐然后同步到各个环境的镜像仓库。

**当前Harbor不支持推送百度CCR，需要修改SDP的镜像同步功能适配CCR服务**。

**建议购买对象存储BOS，在K8S集群上自建Harbor服务。**

## 2. 百度云自建Harbor服务

- 创建 BOS存储桶，访问方式配置为**公共读或者私有**，并**提供相关存储桶名称和Key**
  - BOS提供S3兼容接口时，根据BOS的区域不同需要访问不同的地址（如：s3.bj.bcebos.com）
- 在RDS中创建Postgresql类型的数据，作为Harbor的后端数据库
  - Postgresql 要和K8S主机位于同一个VPC中
  - 提供管理员账号，并创建对应db
- 使用Helm部署Harbor服务
  - 使用loadBalancer暴露Harbor管理服务，并且放开安全组中loadBalancer对应的端口